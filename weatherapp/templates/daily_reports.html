{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Daily Reports</title>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css">
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <link rel="stylesheet" href="{% static 'weatherapp/css/logout.css' %}">
  <style>
      .dataTables_wrapper {
            z-index: 20; 
            position: relative; 
        }
    @media (max-width: 767px) {
      main {
        margin-left: 0 !important;
        padding: 1rem !important;
        width: 100vw;
        overflow-x: hidden;
      }
      
      .dataTables_scrollHead {
        position: sticky !important;
        top: 0;
        z-index: 10;
        background: #2563eb;
      }
      
      .summary-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .filter-controls {
        gap: 0.5rem;
      }
      
      .filter-input {
        min-width: 100%;
      }
      
      .table-responsive {
        width: 100%;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }
      
      .dt-buttons {
        flex-wrap: wrap;
        gap: 0.25rem;
        margin-bottom: 0.5rem;
      }
      
      .dt-button {
        padding: 0.25rem 0.5rem;
        font-size: 0.875rem;
      }
      
      .action-btn {
        padding: 0.25rem 0.5rem;
        font-size: 0.875rem;
      }
    }
    
    @media (min-width: 768px) {
      .summary-grid {
        grid-template-columns: repeat(4, 1fr);
      }
      #dailyTable thead th {
            height: 50px;
            vertical-align: middle;
            position: sticky;
            top: 0;
            z-index: 10;
            background: #2563eb;
        }

        .dataTables_scrollHead {
            position: sticky !important;
            top: 0;
            z-index: 10;
        }

        .dataTables_scrollHeadInner {
            width: auto !important;
        }

        .dataTables_scrollHeadInner table {
            margin-bottom: 0 !important;
        }
    }
    
    .summary-card {
      transition: transform 0.2s;
    }
    
    .summary-card:hover {
      transform: translateY(-2px);
    }
    
    .dataTables_wrapper {
      position: relative;
    }
    
    .dataTables_scrollHeadInner {
      width: auto !important;
    }
    
    .dataTables_scrollBody {
      border-bottom: none !important;
    }
  </style>
</head>
<body class="bg-gray-200 font-sans min-h-screen">

  {% include "weather/header.html" %}

  <div class="flex pt-16">
    {% include "weather/aside.html" %}

    <main class="transition-margin duration-300 flex-1 w-full md:ml-64 mt-0 p-4 md:p-6 space-y-6">
      <div class="info-box w-full">
        <div class="d-flex align-items-center justify-content-center position-relative mb-3 mt-4">
          <h4 class="m-0 text-center w-100">Average Reports per Day</h4>           
        </div>

        <!-- Summary Cards -->
        <div class="grid summary-grid gap-4 mb-6">

          <!-- Temperature -->
          <div class="bg-white p-4 rounded shadow summary-card">
            <h5 class="text-gray-500 text-base font-medium mb-2">Temperature</h5>
            <div class="flex justify-between items-center">
              <div>
                <p class="text-xs text-gray-400">Min</p>
                <p class="text-lg font-bold">
                  {{ summary_stats.min_temp|default:"N/A"|floatformat:1 }}°C
                </p>
                <p class="text-xs text-gray-400">
                  {{ summary_stats.min_temp_date|date:"M d, Y" }}
                </p>
              </div>
              <div class="text-right">
                <p class="text-xs text-gray-400">Max</p>
                <p class="text-lg font-bold">
                  {{ summary_stats.max_temp|default:"N/A"|floatformat:1 }}°C
                </p>
                <p class="text-xs text-gray-400">
                  {{ summary_stats.max_temp_date|date:"M d, Y" }}
                </p>
              </div>
            </div>
          </div>

          <!-- Wind Speed -->
          <div class="bg-white p-4 rounded shadow summary-card">
            <h5 class="text-gray-500 text-base font-medium mb-2">Wind Speed</h5>
            <div class="flex justify-between items-center">
              <div>
                <p class="text-xs text-gray-400">Min</p>
                <p class="text-lg font-bold">
                  {{ summary_stats.min_wind|default:"N/A"|floatformat:1 }} m/s
                </p>
                <p class="text-xs text-gray-400">
                  {{ summary_stats.min_wind_date|date:"M d, Y" }}
                </p>
              </div>
              <div class="text-right">
                <p class="text-xs text-gray-400">Max</p>
                <p class="text-lg font-bold">
                  {{ summary_stats.max_wind|default:"N/A"|floatformat:1 }} m/s
                </p>
                <p class="text-xs text-gray-400">
                  {{ summary_stats.max_wind_date|date:"M d, Y" }}
                </p>
              </div>
            </div>
          </div>

          <!-- Humidity -->
          <div class="bg-white p-4 rounded shadow summary-card">
            <h5 class="text-gray-500 text-base font-medium mb-2">Humidity</h5>
            <div class="flex justify-between items-center">
              <div>
                <p class="text-xs text-gray-400">Min</p>
                <p class="text-lg font-bold">
                  {{ summary_stats.min_humidity|default:"N/A"|floatformat:1 }}%
                </p>
                <p class="text-xs text-gray-400">
                  {{ summary_stats.min_humidity_date|date:"M d, Y" }}
                </p>
              </div>
              <div class="text-right">
                <p class="text-xs text-gray-400">Max</p>
                <p class="text-lg font-bold">
                  {{ summary_stats.max_humidity|default:"N/A"|floatformat:1 }}%
                </p>
                <p class="text-xs text-gray-400">
                  {{ summary_stats.max_humidity_date|date:"M d, Y" }}
                </p>
              </div>
            </div>
          </div>

          <!-- Rainfall -->
          <div class="bg-white p-4 rounded shadow summary-card">
            <h5 class="text-gray-500 text-base font-medium mb-2">Rainfall</h5>
            <div class="flex justify-between items-center">
              <div>
                <p class="text-xs text-gray-400">Min</p>
                <p class="text-lg font-bold">
                  {{ summary_stats.min_rain|default:"N/A"|floatformat:2 }} mm
                </p>
                <p class="text-xs text-gray-400">
                  {{ summary_stats.min_rain_date|date:"M d, Y"}}
                </p>
              </div>
              <div class="text-right">
                <p class="text-xs text-gray-400">Max</p>
                <p class="text-lg font-bold">
                  {{ summary_stats.max_rain|default:"N/A"|floatformat:2 }} mm
                </p>
                <p class="text-xs text-gray-400">
                  {{ summary_stats.max_rain_date|date:"M d, Y" }}
                </p>
              </div>
            </div>
          </div>

        </div>

        <!-- Filter Controls -->
        <div class="bg-white p-4 rounded shadow mb-6">
          <div class="flex flex-wrap filter-controls mb-4">
            <div class="flex-1 filter-input">
              <label for="startDate" class="block text-sm font-medium text-gray-700">From</label>
              <input type="date" id="startDate" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
            </div>
            <div class="flex-1 filter-input">
              <label for="endDate" class="block text-sm font-medium text-gray-700">To</label>
              <input type="date" id="endDate" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
            </div>
            <div class="flex-1 filter-input">
              <label for="sensorFilter" class="block text-sm font-medium text-gray-700">Sensor</label>
              <select id="sensorFilter" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                <option value="">All Sensors</option>
                {% for sensor in sensors %}
                <option value="{{ sensor.sensor_id }}">{{ sensor.name }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="self-end">
              <button id="filterBtn" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition action-btn">
                <i class="fas fa-filter mr-2"></i>Filter
              </button>
              <button id="resetBtn" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition ml-2 action-btn">
                <i class="fas fa-sync-alt mr-2"></i>Reset
              </button>
            </div>
          </div>
        </div>

        <!-- Data Table -->
        <div class="table-responsive bg-white rounded shadow">
          <table id="dailyTable" class="min-w-full border border-gray-300 text-sm">
            <thead class="bg-blue-600 text-white">
              <tr>
                <th>Sensor</th>
                <th>Date</th>
                <th>Temperature (°C)</th>
                <th>Humidity (%)</th>
                <th>Wind Speed (m/s)</th>
                <th>Pressure (hPa)</th>
                <th>Dew Point (°C)</th>
                <th>Rain Rate (mm/h)</th>
                <th>Total Rain (mm)</th>
              </tr>
            </thead>
            <tbody>
              {% if reports %}
                {% for report in reports %}
                <tr>
                  <td>{{ report.name|default:"N/A" }}</td>
                  <td>{{ report.date|date:"Y-m-d"|default:"N/A" }}</td>
                  <td>{{ report.avg_temperature|floatformat:1|default:"N/A" }}</td>
                  <td>{{ report.avg_humidity|floatformat:1|default:"N/A" }}</td>
                  <td>{{ report.avg_wind_speed|floatformat:1|default:"N/A" }}</td>
                  <td>{{ report.avg_barometric_pressure|floatformat:1|default:"N/A" }}</td>
                  <td>{{ report.avg_dew_point|floatformat:1|default:"N/A" }}</td>
                  <td>{{ report.avg_rain_rate|floatformat:2|default:"N/A" }}</td>
                  <td>{{ report.total_rain_accumulated|floatformat:2|default:"N/A" }}</td>
                </tr>
                {% endfor %}
              {% else %}
                <tr>
                  <td colspan="10" class="text-center py-4 text-gray-500">No daily reports available for the selected criteria</td>
                </tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </div>
    </main>
  </div>

  <!--logout modal-->
  <div id="logoutModal" class="hidden fixed inset-0 z-50 overflow-y-auto">
    <div class="flex items-center justify-center min-h-screen p-4">
      <div class="fixed inset-0 bg-gray-900 bg-opacity-50 transition-opacity" aria-hidden="true"></div>
      
      <div class="relative bg-white rounded-xl shadow-2xl overflow-hidden w-full max-w-md transform transition-all">
        <div class="p-6">
          <div class="flex items-start">
            <div class="flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-50">
              <i class="fas fa-sign-out-alt text-red-600 text-xl"></i>
            </div>
            
            <div class="ml-4">
              <h3 class="text-xl font-semibold text-gray-900">Log out of your account?</h3>
              <div class="mt-2">
                <p class="text-gray-600">You'll need to log in again to access your dashboard.</p>
              </div>
            </div>
          </div>
        </div>
        
        <div class="bg-gray-50 px-6 py-4 flex flex-col-reverse sm:flex-row sm:justify-end gap-3">
          <button type="button" onclick="hideLogoutModal()" 
                  class="px-4 py-2 text-sm font-medium text-gray-700 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors">
            Cancel
          </button>
          <button type="button" onclick="performLogout()" 
                  class="px-4 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-700 rounded-lg shadow-sm transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
            Log Out
          </button>
        </div>
      </div>
    </div>
  </div>

  <!--logout loading-->
  <div id="loadingOverlay" class="hidden fixed inset-0 z-50 bg-white bg-opacity-80 flex flex-col items-center justify-center">
    <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-blue-500"></div>
    <p class="mt-4 text-lg font-medium text-gray-700">Logging out...</p>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
  <script src="https://cdn.datatables.net/responsive/2.4.1/js/dataTables.responsive.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.print.min.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
    const alertTypeSelect = document.getElementById('alert_type');
    const severitySelect = document.getElementById('severity');
    
    // --- 1. Robustly Group Options ---
    const allOptions = Array.from(severitySelect.options);

    // FIX: Define the complete list of all potential severity options.
    // Since the original HTML only had Rain options, we add the Wind options here.
    // If your HTML contained all options (Rain first, then Wind), this logic would be simpler.
    
    // 1. Group the currently visible options (Rain options)
    const rainOptions = allOptions; 

    // 2. Define the missing Wind options (assuming these are the desired levels)
    const windOptionsData = [
        { value: 'Gale', text: 'Gale' },
        { value: 'Storm', text: 'Storm' },
        { value: 'Typhoon', text: 'Typhoon' }
    ];
    // Create actual Option elements for Wind
    const windOptions = windOptionsData.map(data => {
        const opt = document.createElement('option');
        opt.value = data.value;
        opt.textContent = data.text;
        return opt;
    });

    // Create a map to store options grouped by their type (Rain/Wind)
    const severityMap = {
        // FIX: The HTML value is lowercase ('rain'), so we use 'rain' as the key
        // We will keep the capitalization logic for robustness, but use lowercase keys.
        'rain': rainOptions, 
        'wind': windOptions
    };

    // Function to dynamically update the Severity dropdown
    function updateSeverityOptions() {
        severitySelect.innerHTML = '';
        
        // Use the actual lowercase value from the HTML ('rain' or 'wind')
        const selectedType = alertTypeSelect.value;
        
        // Get the relevant array of options (either rainOptions or windOptions)
        const optionsToShow = severityMap[selectedType] || []; 

        optionsToShow.forEach(option => {
            severitySelect.appendChild(option.cloneNode(true));
        });
        
        if (severitySelect.options.length > 0) {
            severitySelect.selectedIndex = 0;
        }
    }

    // --- 2. Add Event Listener & Initial Call ---
    
    alertTypeSelect.addEventListener('change', updateSeverityOptions);
    
    // This runs on load and will correctly show the Rain options
    updateSeverityOptions(); 
});

  function showLogoutModal() {
    document.getElementById('logoutModal').classList.remove('hidden');
  }

  function hideLogoutModal() {
    document.getElementById('logoutModal').classList.add('hidden');
  }

  function performLogout() {
    document.getElementById('loadingOverlay').classList.remove('hidden');
    hideLogoutModal();
    
    const logoutBtn = document.querySelector('#logout-form button');
    if (logoutBtn) {
      logoutBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Logging out...';
      logoutBtn.disabled = true;
    }
    
    document.getElementById('logout-form').submit();
  }

  function toggleRainfallDropdown() {
    const menu = document.getElementById('rainfallMenu');
    const arrow = document.getElementById('rainfallArrow');

    menu.classList.toggle('hidden');

    if (menu.classList.contains('hidden')) {
      arrow.classList.remove('fa-chevron-down');
      arrow.classList.add('fa-chevron-right');
    } else {
      arrow.classList.remove('fa-chevron-right');
      arrow.classList.add('fa-chevron-down');
    }
  }

  function toggleUserDropdown() {
    const menu = document.getElementById('userMenu');
    const arrow = document.getElementById('userArrow');

    menu.classList.toggle('hidden');

    if (menu.classList.contains('hidden')) {
      arrow.classList.remove('fa-chevron-down');
      arrow.classList.add('fa-chevron-right');
    } else {
      arrow.classList.remove('fa-chevron-right');
      arrow.classList.add('fa-chevron-down');
    }
  }

  $(document).ready(function () {
    // First, check if we have server-side data
    var hasServerData = {% if reports %}true{% else %}false{% endif %};
    
    // Initialize DataTable with empty data first
    var table = $('#dailyTable').DataTable({
    scrollX: true,
    responsive: false,
    fixedHeader: {
        header: true,
        headerOffset: $('#header').outerHeight()
    },
    dom: 'Bfrtip', // This is crucial - defines where buttons appear
    buttons: [
        'excel', 'pdf', 'print', 'colvis'
    ],
    pageLength: 30,
    lengthMenu: [[10, 30, 60, 90, -1], [10, 30, 60, 90, "All"]],
    language: {
        search: "_INPUT_",
        searchPlaceholder: "Search reports...",
    },
    order: [[1, 'desc']],
    columnDefs: [
        { 
            type: 'date', 
            targets: 1,
            render: function(data, type, row) {
                if (type === 'sort') {
                    return new Date(data).getTime();
                }
                return data;
            }
        },
        { 
            targets: '_all', 
            className: "text-center",
            defaultContent: ""
        }
    ],
    data: [], 
        columns: [
            { data: 'name', title: 'Sensor' },
            { 
                data: 'date', 
                title: 'Date',
                render: function(data) {
                    if (data) {
                        return new Date(data).toLocaleDateString('en-US', { 
                            year: 'numeric', 
                            month: 'short', 
                            day: 'numeric',
                            weekday: 'short'
                        });
                    }
                    return 'N/A';
                }
            },
            { 
                data: 'avg_temperature', 
                title: 'Temperature (°C)',
                render: function(data) {
                    return data ? parseFloat(data).toFixed(1) : 'N/A';
                }
            },
            { 
                data: 'avg_humidity', 
                title: 'Humidity (%)',
                render: function(data) {
                    return data ? parseFloat(data).toFixed(1) : 'N/A';
                }
            },
            { 
                data: 'max_wind_speed', 
                title: 'Max Wind (m/s)',
                render: function(data) {
                    return data ? parseFloat(data).toFixed(1) : 'N/A';
                }
            },
            { 
                data: 'avg_barometric_pressure', 
                title: 'Pressure (hPa)',
                render: function(data) {
                    return data ? parseFloat(data).toFixed(1) : 'N/A';
                }
            },
            { 
                data: 'avg_dew_point', 
                title: 'Dew Point (°C)',
                render: function(data) {
                    return data ? parseFloat(data).toFixed(1) : 'N/A';
                }
            },
            { 
                data: 'max_rain_rate', 
                title: 'Max Rain (mm/h)',
                render: function(data) {
                    return data ? parseFloat(data).toFixed(2) : 'N/A';
                }
            },
            { 
                data: 'total_rain', 
                title: 'Total Rain (mm)',
                render: function(data) {
                    return data ? parseFloat(data).toFixed(2) : 'N/A';
                }
            }
        ]
    });


    // If we have server-side data, load it into the table
    if (hasServerData) {
        var serverData = [
            {% for report in reports %}
            {
                "name": "{{ report.name|default:'N/A' }}",
                "date": "{{ report.date|date:'Y-m-d'|default:'N/A' }}",
                "avg_temperature": "{{ report.avg_temperature|floatformat:1|default:'N/A' }}",
                "avg_humidity": "{{ report.avg_humidity|floatformat:1|default:'N/A' }}",
                "max_wind_speed": "{{ report.avg_wind_speed|floatformat:1|default:'N/A' }}",
                "avg_barometric_pressure": "{{ report.avg_barometric_pressure|floatformat:1|default:'N/A' }}",
                "avg_dew_point": "{{ report.avg_dew_point|floatformat:1|default:'N/A' }}",
                "max_rain_rate": "{{ report.avg_rain_rate|floatformat:2|default:'N/A' }}",
                "total_rain": "{{ report.total_rain_accumulated|floatformat:2|default:'N/A' }}"
            }{% if not forloop.last %},{% endif %}
            {% endfor %}
        ];
        
        table.clear();
        table.rows.add(serverData).draw();
    }

    // Set default date range (last 30 days)
    var today = new Date();
    var thirtyDaysAgo = new Date();
    thirtyDaysAgo.setDate(today.getDate() - 30);
    
    $('#endDate').val(today.toISOString().split('T')[0]);
    $('#startDate').val(thirtyDaysAgo.toISOString().split('T')[0]);

    // Filter button functionality
    $('#filterBtn').on('click', function() {
        loadData();
    });

    // Reset button functionality
    $('#resetBtn').on('click', function() {
        var today = new Date();
        var thirtyDaysAgo = new Date();
        thirtyDaysAgo.setDate(today.getDate() - 30);
        
        $('#endDate').val(today.toISOString().split('T')[0]);
        $('#startDate').val(thirtyDaysAgo.toISOString().split('T')[0]);
        $('#sensorFilter').val('');
        loadData();
    });

    function loadData() {
        $('#filterBtn').html('<i class="fas fa-spinner fa-spin mr-2"></i>Loading...');
        
        var startDate = $('#startDate').val();
        var endDate = $('#endDate').val();
        var sensorId = $('#sensorFilter').val();
        
        $.ajax({
            url: '{% url "daily_reports" %}',
            type: 'GET',
            data: {
                'start_date': startDate,
                'end_date': endDate,
                'sensor_id': sensorId
            },
            success: function(response) {
                table.clear();
                
                if (response.reports && response.reports.length > 0) {
                    var processedData = response.reports.map(function(report) {
                        return {
                            name: report.name || 'N/A',
                            date: report.date,
                            avg_temperature: report.avg_temperature,
                            avg_humidity: report.avg_humidity,
                            max_wind_speed: report.avg_wind_speed,
                            avg_barometric_pressure: report.avg_barometric_pressure,
                            avg_dew_point: report.avg_dew_point,
                            max_rain_rate: report.avg_rain_rate,
                            total_rain: report.total_rain_accumulated
                        };
                    });
                    
                    table.rows.add(processedData).draw();
                } else {
                    // Show "no data" message
                    table.clear().draw();
                }
                
                if (response.summary_stats) {
                    updateSummaryCards(response.summary_stats);
                }
            },
            error: function(xhr, status, error) {
                console.error('Error:', error);
                alert('Error loading data. Please try again.');
            },
            complete: function() {
                $('#filterBtn').html('<i class="fas fa-filter mr-2"></i>Filter');
            }
        });
    }

    function updateSummaryCards(stats) {
        $('.summary-card:nth-child(1) .text-2xl').text(
            stats.avg_temp ? stats.avg_temp + '°C' : 'N/A'
        );
        $('.summary-card:nth-child(2) .text-2xl').text(
            stats.max_wind ? stats.max_wind + ' m/s' : 'N/A'
        );
        $('.summary-card:nth-child(3) .text-2xl').text(
            stats.avg_humidity ? stats.avg_humidity + '%' : 'N/A'
        );
        $('.summary-card:nth-child(4) .text-2xl').text(
            stats.total_rain ? stats.total_rain + ' mm' : 'N/A'
        );
    }

    // Initialize tooltips
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    tooltipTriggerList.forEach(function (tooltipTriggerEl) {
        new bootstrap.Tooltip(tooltipTriggerEl);
    });
    
    // Handle sidebar toggle and table repositioning
    const repositionTable = () => {
      if ($.fn.dataTable.isDataTable('#dailyTable')) {
        table.columns.adjust().responsive.recalc();
        table.fixedHeader.adjust();
      }
    };

    // Call this after sidebar toggle
    document.getElementById('sidebarToggleBtn')?.addEventListener('click', () => {
      setTimeout(repositionTable, 300);
    });

    // Also call on window resize
    window.addEventListener('resize', repositionTable);
});

document.addEventListener('DOMContentLoaded', () => {
    const sidebar = document.getElementById('sidebar');
    const sidebarToggleBtn = document.getElementById('sidebarToggleBtn');
    const mainContent = document.querySelector('main');

    // Initialize state
    const initSidebar = () => {
        const isDesktop = window.innerWidth >= 768;
        
        if (isDesktop) {
            sidebar.classList.remove('-translate-x-full');
            mainContent.classList.add('md:ml-64');
        } else {
            sidebar.classList.add('-translate-x-full');
            mainContent.classList.remove('md:ml-64');
        }
    };

    // Toggle function
    const toggleSidebar = () => {
        const isDesktop = window.innerWidth >= 768;
        
        sidebar.classList.toggle('-translate-x-full');
        
        if (isDesktop) {
            mainContent.classList.toggle('md:ml-64');
            mainContent.classList.toggle('md:ml-0');
        }
    };

    // Handle window resize
    const handleResize = () => {
        const isDesktop = window.innerWidth >= 768;
        
        if (isDesktop) {
            if (!sidebar.classList.contains('-translate-x-full')) {
                mainContent.classList.add('md:ml-64');
                mainContent.classList.remove('md:ml-0');
            }
        } else {
            mainContent.classList.remove('md:ml-64');
            mainContent.classList.add('md:ml-0');
        }
    };

    // Event listeners
    sidebarToggleBtn?.addEventListener('click', toggleSidebar);
    window.addEventListener('resize', handleResize);
    
    // Initialize
    initSidebar();
});
  </script>
</body>
</html>